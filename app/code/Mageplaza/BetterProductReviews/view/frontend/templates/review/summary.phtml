<?php
/**
 * Mageplaza
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Mageplaza.com license that is
 * available through the world-wide-web at this URL:
 * https://www.mageplaza.com/LICENSE.txt
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade this extension to newer
 * version in the future.
 *
 * @category    Mageplaza
 * @package     Mageplaza_BetterProductReviews
 * @copyright   Copyright (c) Mageplaza (https://www.mageplaza.com/)
 * @license     https://www.mageplaza.com/LICENSE.txt
 */

/** @var \Mageplaza\BetterProductReviews\Block\Review\Summary $block */
?>
<?php
    if ($block->getProduct()) {
        $_ratingSummaryHead = $block->getRatingSummary($block->getProduct());
        $_reviewCountHead = $block->getReviewCount($block->getProduct());
    }
?>
<?php if ($block->isReviewSummaryEnabled()) : ?>
    <div class="block-title-head">
        <h2><?php echo __('Reviews') ?></h2>
    </div>
    <div class="review_grey_main">
        <div class="review_grey_section">
            <div class="rgs_top">
                <div class="rgs_top_row">
                    <div class="rgs_stars">
                        <div class="rgs_star">
                            <div class="rating-summary">
                                <div title="<?php echo (int)$_ratingSummaryHead; ?>%" class="rating-result">
                                <span style="width:<?php echo (int)$_ratingSummaryHead; ?>%"><span><?php echo (int)$_ratingSummaryHead; ?>
                                        %</span></span>
                                </div>
                            </div>
                        </div>
                        <div class="rgs_number">
                        <?php echo number_format((float)($_ratingSummaryHead / 20), 1); ?>
                        </div>
                    </div>
                    <div class="rgs_no_ofReview">
                        <?php echo ((int)$_reviewCountHead == 1) ? __('%1 review', $_reviewCountHead) : __('%1 reviews', $_reviewCountHead); ?>
                    </div>
                </div>
                <div class="rgs_recomment_text">
                    <div class="recommend-product">
                        <span><?php echo __('%1',$block->getReviewsRecommendedCount());
                                    echo __(' out of %1',$block->getReviewsRecommendCount());
                                    echo __(' (%1%) reviewers recommend this product',$block->getReviewsRecommendPercent()); 
                                ?>            
                        </span>
                    </div>
                </div>
            </div>
            <!-- <div class="rgs_bottom">
                <div class="rgsb_number_review_search">
                    <input id="bv-text-field-search-contentSearch1" class="bv-text bv-focusable bv-search-text" type="text" name="bv-search" placeholder="Search reviews">
                    <button type="button" class="bv-content-btn bv-content-search-btn bv-focusable" tabindex="-1" aria-disabled="true" disabled=""> <span class="bv-search-control-icon" aria-hidden="true">ϙ</span></button>
                </div>
                <div class="rgsb_number_review">
                    <?php //echo ((int)$_reviewCountHead == 1) ? __('%1 review', $_reviewCountHead) : __('%1 reviews', $_reviewCountHead); ?>
                </div>
            </div> -->
        </div>
    </div>
    <div id="mp-review-summary" class="block review-summary">
        <div class="block-title">
            <h2><?php echo __('Reviews') ?></h2>
            <?php if ($block->isWriteReviewEnabled()) : ?>
                    <button title="<?php echo __('Write a review') ?>" class="action primary"
                            id="mp-review-write-review-button">
                        <span><?php echo __('Write a review') ?></span>
                    </button>
            <?php endif; ?>
        </div>
        <div class="block-content">
            <div class="mp-review-details col-mp mp-4 mp-md-4 mp-sm-5 mp-xs-12">
                <div class="bv-inline-histogram-header"> <h3 class="bv-content-title"><?php echo __('Rating Snapshot') ?></h3> </div>
                <?php for ($starValue = 5; $starValue >= 1; $starValue--) { ?>
                    <div class="mp-review-details-<?php echo $starValue ?>stars">
                        <div class="stars-title"><?php echo $starValue ?></div>
                        <span class="bv-glyph" aria-hidden="true">★</span>
                        <div class="stars-process">
                            <div style="width:<?php echo (int)$block->getReviewsVotingPercentByValue($starValue); ?>%"
                                 class="stars-process-active"></div>
                        </div>
                        <span><?php echo $block->getReviewsVotingCountByStar($starValue) ?></span>
                    </div>
                <?php } ?>
            </div>
            <div class="mp-review-statistic col-mp mp-4 mp-md-4 mp-sm-5 mp-xs-12">
                <div class="bv-secondary-rating-summary-header"> <h3 class="bv-content-title"><?php echo __('Average Customer Ratings') ?></h3> </div>
                <div class="summary-points">
                    <?php
                    if ($block->getProduct()) {
                        $_ratingSummary = $block->getRatingSummary($block->getProduct());
                        $_reviewCount = $block->getReviewCount($block->getProduct());
                        ?>
                        <?php if ($_ratingSummary) { ?>
                            <span class="summary-points-text"><?php echo __('Overall ') ?></span>
                            <div class="product-reviews-summary short">
                                <div class="rating-summary">
                                    <div title="<?php echo (int)$_ratingSummary; ?>%" class="rating-result">
                                    <span style="width:<?php echo (int)$_ratingSummary; ?>%"><span><?php echo (int)$_ratingSummary; ?>
                                            %</span></span>
                                    </div>
                                </div>
                                <span><?php echo number_format((float)($_ratingSummary / 20), 1); ?></span>
                            </div>
                        <?php } else { ?>
                            <div class="product-reviews-summary short">
                                <div class="reviews-actions">
                                    <?php echo ($_reviewCount) ? ((int)$_reviewCount == 1)
                                        ? __('%1 review', $_reviewCount) : __('%1 reviews', $_reviewCount)
                                        : __('Be the first to review this product'); ?>
                                </div>
                            </div>
                        <?php }
                    } ?>
                </div>
            </div>
            
        </div>
    </div>

<?php else : ?>
    <?php if ($block->isWriteReviewEnabled()) : ?>
        <div id="mp-write-review" class="mp-review-button">
            <button title="<?php echo __('Write a review') ?>" class="action primary"
                    id="mp-review-write-review-button">
                <span><?php echo __('Write a review') ?></span>
            </button>
        </div>
    <?php endif; ?>
<?php endif; ?>
<div id="write-review-message" class="messages mp-betterproductreviews-message"></div>
<script type="text/javascript">
    require([
        'jquery',
        'mp_productReviewMessage',
        'Magento_Ui/js/modal/modal'
    ], function ($, mp_productReviewMessage, modal) {
        var writeReviewEnabled = <?php echo $block->getWriteReviewRestriction() ?>,
            writeReviewBtn = $('#mp-review-write-review-button'),
            writeNameReviewBtn = $('#openpopupmodal'),
            writeReviewContainer = $('#mp-review-form'),
            writeReviewNotice = "<?php echo $block->getCustomerNotice() ?>";

            var writeReviewMessage = $('#mp-form-submit-message');

            var options = {
                type: 'popup',
                responsive: true,
                innerScroll: true,
            };
            var popup = modal(options, writeReviewContainer);
            var popup = modal(options, writeReviewMessage);
            
        writeReviewBtn.on('click', function () {
            if (writeReviewEnabled) {
                $(writeReviewContainer).modal("openModal");
            } else {
                $('#write-review-message').html(mp_productReviewMessage.getInfoMessage(writeReviewNotice));
            }
        });

        writeNameReviewBtn.on('click', function () {
            if (writeReviewEnabled) {
                $(writeReviewContainer).modal("openModal");
            }
        });
    });
</script>
